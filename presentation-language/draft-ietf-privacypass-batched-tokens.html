<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Batched Token Issuance Protocol</title>
<meta content="Raphael Robert" name="author">
<meta content="Christopher A. Wood" name="author">
<meta content="
       This document specifies a variant of the Privacy Pass issuance protocol that
allows for batched issuance of tokens. This allows clients to request more than
one token at a time and for issuers to issue more than one token at a time. 
    " name="description">
<meta content="xml2rfc 3.24.0" name="generator">
<meta content="Internet-Draft" name="keyword">
<meta content="draft-ietf-privacypass-batched-tokens-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.24.0
    Python 3.12.7
    ConfigArgParse 1.7
    google-i18n-address 3.1.1
    intervaltree 3.1.0
    Jinja2 3.1.4
    lxml 5.3.0
    platformdirs 4.3.6
    pycountry 22.3.5
    PyYAML 6.0.1
    requests 2.32.3
    setuptools 70.3.0
    wcwidth 0.2.13
-->
<link href="draft-ietf-privacypass-batched-tokens.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Lora SemiBold'), local('Lora-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C8A, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-cyrillic.woff2') format('woff2');
  unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-greek.woff2') format('woff2');
  unicode-range: U+0370-0377, U+037A-037F, U+0384-038A, U+038C, U+038E-03A1, U+03A3-03FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C8A, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-greek.woff2') format('woff2');
  unicode-range: U+0370-0377, U+037A-037F, U+0384-038A, U+038C, U+038E-03A1, U+03A3-03FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

:root {
  color-scheme: light dark;
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --pilcrow-weak: #ddd;
  --pilcrow-strong: #bbb;
  --small-font-size: 14.5px;
  --font-mono: 'Oxygen Mono', monospace;
  --font-title: "Sofia Sans Semi Condensed", sans-serif;
  scrollbar-color: #bbb #eee;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
section {
  clear: both;
}
.section-number {
  padding-right: 0.5em;
}
h1, h2, h3, h4, h5, h6 {
  font-family: var(--font-title);
  font-weight: 680;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
h1#title {
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1#title, h1#rfcnum {
  margin: 1.5em 0 0.2em;
}
h1#rfcnum + h1#title {
  margin: 0.2em 0;
}

h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
  vertical-align: top;
}
#abstract+p {
  font-size: 18px;
  line-height: 24px;
}
#abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 16px;
  line-height: 0;
}

p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
/* font-family isn't space-separated, but =~ will have to do */
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
  & :is(ol, ul) {
    margin-left: 1em;
  }
}
li {
  margin: 0 0 0.25em 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
  & li {
    margin-top: 0.5em;
  }
}
:is(ul, ol).compact, .ulCompact, .olCompact {
  margin: 0 0 0 2em;
  & li {
    margin: 0;
    & :first-child { margin-top: 0; }
    & :last-child { margin-bottom: 0; }
  }
}

/* definition lists */
dl {
  clear: left;
  --indent: 3ch;
  /* --indent: attr(indent ch); not supported in any browser, but we can dream */
  &.olPercent {
    --indent: 5ch;
    & > dt {
      min-width: calc(var(--indent) - 2ch);
    }
  }
  &.olPercent > dt {
    float: none;
  }

  dl > dd > & {
    margin-top: 0.5em;
    margin-bottom: 0;
  }
}
dl > dt {
  float: left;
  margin-right: 2ch;
  min-width: 8ch;
}
dl > dd {
  margin-bottom: .8em;
  margin-left: var(--indent) !important; /* stupid element overrides */
  min-height: 2ex;
}
:is(dl.compact, .dlCompact) > dd {
  margin-bottom: 0;
  & > :is(:first-child, .break:first-child + *) {
    margin-top: 0;
  }
  & > :is(:last-child) {
    margin-bottom: 0;
  }
}
:is(dd, span).break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href] {
  color: var(--link-color);
}
a[href].selfRef, .iref + a[href].internal {
  color: var(--text-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref:is(.cite, .auto), :is(#status-of-memo, #copyright) a {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px var(--font-mono);
}
tt, code {
  /* changing the font for inline elements leads to different ascender
     and descender heights; as we want to retain baseline alignment,
     remove leading to avoid altering the final height of lines
     note: this fails if these blocks take an entire line,
     a different solution would be great */
  line-height: 0;
}
:is(h1, h2, h3, h4, h5, h6) :is(tt, code) {
  font-size: 84%;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
  caption-side: bottom;
}
@media screen {
  /* Auto-collapse boilerplate. */
  :is(#status-of-memo, #copyright) p {
    margin: -2px 0;
    max-height: 0;
    transition: max-height 2s ease, margin 0.5s ease 0.5s;
    overflow: hidden;
  }
  :is(#status-of-memo, #copyright):hover p,
  :is(#status-of-memo, #copyright) h2:target ~ p {
    margin: 0.5em 0;
    max-height: 500px;
    overflow: auto;
  }
  pre, svg {
    display: inline-block;
    overflow-x: auto;
  }
  pre {
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  svg {
    max-width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  :is(pre, svg) + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: auto;
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
table .text-left {
  text-align: left;
}
table .text-center {
  text-align: center;
}
table .text-right {
  text-align: right;
}

thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
:is(tr:nth-child(2n), thead+tbody > tr:nth-child(2n+1)) > td {
  background-color: var(--background-color);
}
:is(tr:nth-child(2n+1), thead+tbody > tr:nth-child(2n)) > td {
  background-color: var(--highlight-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
  &[href] {
    color: var(--pilcrow-weak);
    &:hover { text-decoration: none; }
  }
}
@media not print {
  :hover > a.pilcrow {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: var(--pilcrow-strong);
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
  font-weight: 600;
  font-size: var(--small-font-size);
}
.role {
  font-variant: all-small-caps;
}
sub, sup {
  line-height: 1;
  font-size: 80%;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 15ch;
  & dt {
    width: var(--identifier-width);
    min-width: var(--identifier-width);
    clear: left;
    float: left;
    text-align: right;
    margin-right: 1ch;
  }
  & dd {
    margin: 0;
    margin-left: calc(1em + var(--identifier-width)) !important;
    min-width: 5em;
  }
  & .authors {
    & .author {
      display: inline-block;
      margin-right: 1.5em;
    }
    & .org {
      font-style: italic;
    }
  }
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;

  & nav {
    & ul {
      margin: 0 0.5em 0 0;
      padding: 0;
      list-style: none;
    }
    & li {
      line-height: 1.3em;
      margin: 2px 0;
      padding-left: 1.2em;
      text-indent: -1.2em;
    }
  }
  & a.xref {
    white-space: normal;
  }
}

.references {
  & > dt {
    text-align: right;
    font-weight: bold;
    min-width: 10ch;
    margin-right: 1.5ch;
    &:target::before {
      content: "⇒";
      margin: 0 10px 0 -25px;
    }
  }
  & > dd {
    margin-left: 12ch !important;
    overflow: visible;
    & .refInstance {
      margin-bottom: 0.8em;
    }
    & .ascii {
      margin-bottom: 0.25em;
    }
  }
}

#rfc\.index\.index + ul {
  margin-left: 0;
}

/* authors */
address.vcard {
  font-style: normal;
  max-width: 20em;
  margin: 1em auto 1em 0;

  & .nameRole {
    font-weight: 700;
    margin-left: 0;
  }
  & .label {
    margin: 0.5em 0;
  }
  & .type {
    display: none;
  }
  & .alternative-contact {
    margin: 0.5em 0 0.25em 0;
  }
  & .non-ascii {
    margin: 0 0 0 2em;
  }
  & div.left {
    text-align: left;
  }
  & div.right {
    text-align: right;
  }
}

hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

/* Comments */
.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}

@media screen {
  #toc nav {
    font-family: var(--font-title);
    font-weight: 360;
    & > ul { margin-bottom: 2em; }
    & ul {
      margin: 0 0 0 4px;
      & :is(p, li) {
        margin: 2px 0;
      }
    }
  }
  #toc a.toplink {
    float: right;
  }
}
@media not screen {
  #toc a.toplink {
    display: none;
  }
}


/* TOC layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 1px 0 0 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
    &::before { /* css hamburger */
      float: right;
      position: relative;
      width: 1em;
      height: 1px;
      left: -164px;
      margin: 8px 0 0 0;
      background: white none repeat scroll 0 0;
      box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
      content: "";
    }
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active {
    opacity: 1;
    & nav { display: block; }
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:is(:link, :focus, :hover),
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin: 2px 0.5em 0;
  }
}

/* TOC layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
  #toc a.toplink {
    margin: 8px 0.5em 0;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre, .vcard {
    page-break-inside: avoid;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  :is(h2, h3, h4, h5, h6)+*, dd {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Dark mode. */
@media (prefers-color-scheme: dark) {
:root {
  --background-color: #121212;
  --text-color: #f0f0f0;
  --title-color: #fff;
  --link-color: #4da4f0;
  --highlight-color: #282828;
  --line-color: #444;
  --pilcrow-weak: #444;
  --pilcrow-strong: #666;
  scrollbar-color: #777 #333;
}
}

/* SVG Trick: a prefix match works because only black and white are allowed */
svg :is([stroke="black"], [stroke^="#000"]) {
  stroke: var(--text-color);
}
svg :is([stroke="white"], [stroke^="#fff"]) {
  stroke: var(--background-color);
}
svg :is([fill="black"], [fill^="#000"], :not([fill])) {
  fill: var(--text-color);
}
svg :is([fill="white"], [fill^="#fff"]) {
  fill: var(--background-color);
}
</style>

</head>
<body class="xml2rfc">
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">Batched Tokens</td>
<td class="right">November 2024</td>
</tr></thead>
<tfoot><tr>
<td class="left">Robert &amp; Wood</td>
<td class="center">Expires 28 May 2025</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Network Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-ietf-privacypass-batched-tokens-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2024-11-24" class="published">24 November 2024</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2025-05-28">28 May 2025</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">R. Robert</div>
<div class="org">Phoenix R&amp;D</div>
</div>
<div class="author">
      <div class="author-name">C. A. Wood</div>
<div class="org">Cloudflare</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Batched Token Issuance Protocol</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document specifies a variant of the Privacy Pass issuance protocol that
allows for batched issuance of tokens. This allows clients to request more than
one token at a time and for issuers to issue more than one token at a time.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 28 May 2025.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2024 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-change-log" class="internal xref">Change Log:</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1" class="keepWithNext"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1" class="keepWithNext"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-motivation" class="internal xref">Motivation</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-presentation-language" class="internal xref">Presentation Language</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="auto internal xref">4.1</a>.  <a href="#name-optional-value" class="internal xref">Optional Value</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="auto internal xref">4.2</a>.  <a href="#name-variable-size-vector-length" class="internal xref">Variable-Size Vector Length Headers</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-batched-privately-verifiabl" class="internal xref">Batched Privately Verifiable Token</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="auto internal xref">5.1</a>.  <a href="#name-client-to-issuer-request" class="internal xref">Client-to-Issuer Request</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="auto internal xref">5.2</a>.  <a href="#name-issuer-to-client-response" class="internal xref">Issuer-to-Client Response</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a href="#section-5.3" class="auto internal xref">5.3</a>.  <a href="#name-finalization" class="internal xref">Finalization</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-arbitrary-batched-token-iss" class="internal xref">Arbitrary Batched Token Issuance</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="auto internal xref">6.1</a>.  <a href="#name-client-to-issuer-request-2" class="internal xref">Client-to-Issuer Request</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="auto internal xref">6.2</a>.  <a href="#name-issuer-to-client-response-2" class="internal xref">Issuer-to-Client Response</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.3">
                <p id="section-toc.1-1.6.2.3.1"><a href="#section-6.3" class="auto internal xref">6.3</a>.  <a href="#name-finalization-2" class="internal xref">Finalization</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.  <a href="#name-security-considerations" class="internal xref">Security considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="auto internal xref">7.1</a>.  <a href="#name-batched-privately-verifiable" class="internal xref">Batched Privately Verifiable Tokens</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a href="#section-7.2" class="auto internal xref">7.2</a>.  <a href="#name-arbitrary-batched-verifiabl" class="internal xref">Arbitrary Batched Verifiable Tokens</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="auto internal xref">8</a>.  <a href="#name-iana-considerations" class="internal xref">IANA considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a href="#section-8.1" class="auto internal xref">8.1</a>.  <a href="#name-token-type" class="internal xref">Token Type</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2">
                <p id="section-toc.1-1.8.2.2.1"><a href="#section-8.2" class="auto internal xref">8.2</a>.  <a href="#name-media-types" class="internal xref">Media Types</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2.2.1">
                    <p id="section-toc.1-1.8.2.2.2.1.1"><a href="#section-8.2.1" class="auto internal xref">8.2.1</a>.  <a href="#name-application-private-token-p" class="internal xref">"application/private-token-privately-verifiable-batch-request" media type</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2.2.2">
                    <p id="section-toc.1-1.8.2.2.2.2.1"><a href="#section-8.2.2" class="auto internal xref">8.2.2</a>.  <a href="#name-application-private-token-pr" class="internal xref">"application/private-token-privately-verifiable-batch-response" media type</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2.2.3">
                    <p id="section-toc.1-1.8.2.2.2.3.1"><a href="#section-8.2.3" class="auto internal xref">8.2.3</a>.  <a href="#name-application-private-token-a" class="internal xref">"application/private-token-arbitrary-batch-request" media type</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2.2.4">
                    <p id="section-toc.1-1.8.2.2.2.4.1"><a href="#section-8.2.4" class="auto internal xref">8.2.4</a>.  <a href="#name-application-private-token-ar" class="internal xref">"application/private-token-arbitrary-batch-response" media type</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="auto internal xref">9</a>.  <a href="#name-references" class="internal xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a href="#section-9.1" class="auto internal xref">9.1</a>.  <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a href="#section-9.2" class="auto internal xref">9.2</a>.  <a href="#name-informative-references" class="internal xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#appendix-A" class="auto internal xref"></a><a href="#name-authors-addresses" class="internal xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="change-log">
<section id="section-1">
      <h2 id="name-change-log">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-change-log" class="section-name selfRef">Change Log:</a>
      </h2>
<p id="section-1-1">RFC EDITOR PLEASE DELETE THIS SECTION.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">draft-03<a href="#section-1-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1-3.1">
          <p id="section-1-3.1.1">Arbitrary token types<a href="#section-1-3.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-1-3.2">
          <p id="section-1-3.2.1">Error code 400 aligned with RFC9578 and replaced by error code 422<a href="#section-1-3.2.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-1-4">draft-02<a href="#section-1-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1-5.1">
          <p id="section-1-5.1.1">Renaming TokenRequest to BatchTokenRequest and TokenResponse to
BatchTokenResponse<a href="#section-1-5.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-1-5.2">
          <p id="section-1-5.2.1">IANA: Media types for BatchTokenRequest and BatchTokenResponse<a href="#section-1-5.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-1-5.3">
          <p id="section-1-5.3.1">IANA: Expand Token Type registry entry<a href="#section-1-5.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-1-5.4">
          <p id="section-1-5.4.1">Various editorial fixes<a href="#section-1-5.4.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-1-6">draft-01<a href="#section-1-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1-7.1">
          <p id="section-1-7.1.1">Initial WG document version<a href="#section-1-7.1.1" class="pilcrow">¶</a></p>
</li>
      </ul>
</section>
</div>
<div id="introduction">
<section id="section-2">
      <h2 id="name-introduction">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-2-1">This document specifies two Privacy Pass issuance protocols (as defined in
<span>[<a href="#RFC9576" class="cite xref">RFC9576</a>]</span>) that allow for batched issuance
of tokens. This allows clients to request more than one token at a time and for
issuers to issue more than one token at a time.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">The base Privacy Pass issuance protocol
<span>[<a href="#RFC9578" class="cite xref">RFC9578</a>]</span> defines stateless anonymous tokens,
which can either be publicly verifiable or not. While it is possible to run
multiple instances of the issuance protocol in parallel, e.g., over a
multiplexed transport such as HTTP/3 <span>[<a href="#HTTP3" class="cite xref">HTTP3</a>]</span> or by orchestrating
multiple HTTP requests, these ad-hoc solutions vary based on transport protocol
support. In addition, in some cases, they cannot take advantage of cryptographic
optimizations.<a href="#section-2-2" class="pilcrow">¶</a></p>
<p id="section-2-3">The first variant of the issuance protocol builds upon the privately verifiable
issuance protocol in <span>[<a href="#RFC9578" class="cite xref">RFC9578</a>]</span> that uses VOPRF <span>[<a href="#OPRF" class="cite xref">OPRF</a>]</span>,
and allows for batched issuance of tokens. This allows clients to request more
than one token at a time and for issuers to issue more than one token at a time.
In effect, private batched issuance performance scales better than linearly.<a href="#section-2-3" class="pilcrow">¶</a></p>
<p id="section-2-4">The second variant of the issuance protocol introduces a new Client-Issuer
communication method, which allows for batched issuance of arbitrary token
types. This allows clients to request more than one token at a time and for
issuers to issue more than one token at a time. This variant has no other effect
than batching requests and responses and the issuance performance remains
linear.<a href="#section-2-4" class="pilcrow">¶</a></p>
<p id="section-2-5">This batched issuance protocol registers one new token type
(<a href="#iana-token-type" class="auto internal xref">Section 8.1</a>), to be used with the PrivateToken HTTP authentication
scheme defined in <span>[<a href="#AUTHSCHEME" class="cite xref">AUTHSCHEME</a>]</span>.<a href="#section-2-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="motivation">
<section id="section-3">
      <h2 id="name-motivation">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-motivation" class="section-name selfRef">Motivation</a>
      </h2>
<p id="section-3-1">Privacy Pass tokens (as defined in <span>[<a href="#RFC9576" class="cite xref">RFC9576</a>]</span> and
<span>[<a href="#RFC9578" class="cite xref">RFC9578</a>]</span>) are unlinkable during issuance and
redemption. The basic issuance protocols defined in <span>[<a href="#RFC9578" class="cite xref">RFC9578</a>]</span> however only
allow for a single token to be issued at a time for every challenge. In some
cases, especially where a large number of clients need to fetch a large number
of tokens, this may introduce performance bottlenecks. Batched token issuance
improves upon the basic Privately Verifiable Token issuance protocol in the
following key ways:<a href="#section-3-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-3-2">
<li id="section-3-2.1">
          <p id="section-3-2.1.1">Issuing multiple tokens at once in response to a single TokenChallenge,
thereby reducing the size of the proofs required for multiple tokens.<a href="#section-3-2.1.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-3-2.2">
          <p id="section-3-2.2.1">Improving server and client issuance efficiency by amortizing the cost of the
VOPRF proof generation and verification, respectively.<a href="#section-3-2.2.1" class="pilcrow">¶</a></p>
</li>
      </ol>
<p id="section-3-3">For all Verifiable Token issuance protocol, it allows for a single TokenRequest
to be sent that encompasses multiple token requests. This enables the issuance
of tokens for more than one key in one round trip between the Client and the
Issuer. The cost remains linear.<a href="#section-3-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="presentation-language">
<section id="section-4">
      <h2 id="name-presentation-language">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-presentation-language" class="section-name selfRef">Presentation Language</a>
      </h2>
<p id="section-4-1">This document uses the TLS presentation language <span>[<a href="#RFC8446" class="cite xref">RFC8446</a>]</span> to describe the
structure of protocol messages.  In addition to the base syntax, it uses two
additional features: the ability for fields to be optional and the ability for
vectors to have variable-size length headers.<a href="#section-4-1" class="pilcrow">¶</a></p>
<div id="optional-value">
<section id="section-4.1">
        <h3 id="name-optional-value">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-optional-value" class="section-name selfRef">Optional Value</a>
        </h3>
<p id="section-4.1-1">An optional value is encoded with a presence-signaling octet, followed by the
value itself if present.  When decoding, a presence octet with a value other
than 0 or 1 MUST be rejected as malformed.<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<div class="lang-tls-presentation sourcecode" id="section-4.1-2">
<pre>
struct {
    uint8 present;
    select (present) {
        case 0: struct{};
        case 1: T value;
    };
} optional&lt;T&gt;;
</pre><a href="#section-4.1-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="variable-size-vector-length-headers">
<section id="section-4.2">
        <h3 id="name-variable-size-vector-length">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-variable-size-vector-length" class="section-name selfRef">Variable-Size Vector Length Headers</a>
        </h3>
<p id="section-4.2-1">In the TLS presentation language, vectors are encoded as a sequence of encoded
elements prefixed with a length.  The length field has a fixed size set by
specifying the minimum and maximum lengths of the encoded sequence of elements.<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<p id="section-4.2-2">In this document, there are several vectors whose sizes vary over significant
ranges.  So instead of using a fixed-size length field, it uses a variable-size
length using a variable-length integer encoding based on the one described in
<span><a href="https://rfc-editor.org/rfc/rfc9000#section-16" class="relref">Section 16</a> of [<a href="#RFC9000" class="cite xref">RFC9000</a>]</span>. They differ only in that the one here requires a
minimum-size encoding. Instead of presenting min and max values, the vector
description simply includes a <code>V</code>. For example:<a href="#section-4.2-2" class="pilcrow">¶</a></p>
<div class="lang-tls-presentation sourcecode" id="section-4.2-3">
<pre>
struct {
    uint32 fixed&lt;0..255&gt;;
    opaque variable&lt;V&gt;;
} StructWithVectors;
</pre><a href="#section-4.2-3" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="batched-privately-verifiable-token">
<section id="section-5">
      <h2 id="name-batched-privately-verifiabl">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-batched-privately-verifiabl" class="section-name selfRef">Batched Privately Verifiable Token</a>
      </h2>
<p id="section-5-1">This section describes a batched issuance protocol for select token types,
including 0x0001 (defined in <span>[<a href="#RFC9578" class="cite xref">RFC9578</a>]</span>) and 0xF91A (defined in this document).
This variant is more efficient than Arbitary Batch Token Issuance defined below.
It does so by requiring the same key to be used by all token requests.<a href="#section-5-1" class="pilcrow">¶</a></p>
<div id="client-to-issuer-request">
<section id="section-5.1">
        <h3 id="name-client-to-issuer-request">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-client-to-issuer-request" class="section-name selfRef">Client-to-Issuer Request</a>
        </h3>
<p id="section-5.1-1">Except where specified otherwise, the client follows the same protocol as
described in <span>[<a href="#RFC9578" class="cite xref">RFC9578</a>], <a href="https://datatracker.ietf.org/doc/html/draft-ietf-privacypass-protocol-16#section-5.1" class="relref">Section 5.1</a></span>.<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<p id="section-5.1-2">The Client first creates a context as follows:<a href="#section-5.1-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.1-3">
<pre>
client_context = SetupVOPRFClient(ciphersuiteID, pkI)
</pre><a href="#section-5.1-3" class="pilcrow">¶</a>
</div>
<p id="section-5.1-4"><code>ciphersuiteID</code> is the ciphersuite identifier from <span>[<a href="#OPRF" class="cite xref">OPRF</a>]</span> corresponding to the
ciphersuite being used for this token version. SetupVOPRFClient is defined in
<span>[<a href="#OPRF" class="cite xref">OPRF</a>], <a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-voprf-21#section-3.2" class="relref">Section 3.2</a></span>.<a href="#section-5.1-4" class="pilcrow">¶</a></p>
<p id="section-5.1-5"><code>Nr</code> denotes the number of tokens the clients wants to request. For every token,
the Client then creates an issuance request message for a random value <code>nonce</code>
with the input challenge and Issuer key identifier as described below:<a href="#section-5.1-5" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.1-6">
<pre>
nonce_i = random(32)
challenge_digest = SHA256(challenge)
token_input = concat(token_type, nonce_i, challenge_digest,
                token_key_id)
blind_i, blinded_element_i = client_context.Blind(token_input)
</pre><a href="#section-5.1-6" class="pilcrow">¶</a>
</div>
<p id="section-5.1-7"><code>token_type</code> corresponds to the 2-octet integer in the challenge.<a href="#section-5.1-7" class="pilcrow">¶</a></p>
<p id="section-5.1-8">The above is repeated for each token to be requested. Importantly, a fresh nonce
MUST be sampled each time.<a href="#section-5.1-8" class="pilcrow">¶</a></p>
<p id="section-5.1-9">The Client then creates a BatchTokenRequest structured as follows:<a href="#section-5.1-9" class="pilcrow">¶</a></p>
<div class="lang-tls sourcecode" id="section-5.1-10">
<pre>
struct {
    uint8_t blinded_element[Ne];
} BlindedElement;

struct {
   uint16_t token_type;
   uint8_t truncated_token_key_id;
   BlindedElement blinded_elements&lt;V&gt;;
} BatchTokenRequest;
</pre><a href="#section-5.1-10" class="pilcrow">¶</a>
</div>
<p id="section-5.1-11">The structure fields are defined as follows:<a href="#section-5.1-11" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1-12.1">
            <p id="section-5.1-12.1.1">"token_type" is a 2-octet integer, which matches the type in the challenge.<a href="#section-5.1-12.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.1-12.2">
            <p id="section-5.1-12.2.1">"truncated_token_key_id" is the least significant byte of the <code>token_key_id</code>
in network byte order (in other words, the last 8 bits of <code>token_key_id</code>).<a href="#section-5.1-12.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.1-12.3">
            <p id="section-5.1-12.3.1">"blinded_elements" is a list of <code>Nr</code> serialized elements, each of length <code>Ne</code>
bytes and computed as <code>SerializeElement(blinded_element_i)</code>, where
blinded_element_i is the i-th output sequence of <code>Blind</code> invocations above. Ne
is as defined in <span>[<a href="#OPRF" class="cite xref">OPRF</a>], <a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-voprf-21#section-4" class="relref">Section 4</a></span>.<a href="#section-5.1-12.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-5.1-13">The Client then generates an HTTP POST request to send to the Issuer Request
URL, with the BatchTokenRequest as the content. The media type for this request
is "application/private-token-privately-verifiable-batch-request". An example
request for the Issuer Request URL "https://issuer.example.net/request" is shown
below.<a href="#section-5.1-13" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.1-14">
<pre>
POST /request HTTP/1.1
Host: issuer.example.net
Accept: application/private-token-privately-verifiable-batch-response
Content-Type: application/private-token-privately-verifiable-batch-request
Content-Length: &lt;Length of BatchTokenRequest&gt;

&lt;Bytes containing the BatchTokenRequest&gt;
</pre><a href="#section-5.1-14" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="issuer-to-client-response">
<section id="section-5.2">
        <h3 id="name-issuer-to-client-response">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-issuer-to-client-response" class="section-name selfRef">Issuer-to-Client Response</a>
        </h3>
<p id="section-5.2-1">Except where specified otherwise, the client follows the same protocol as
described in <span>[<a href="#RFC9578" class="cite xref">RFC9578</a>], <a href="https://datatracker.ietf.org/doc/html/draft-ietf-privacypass-protocol-16#section-5.2" class="relref">Section 5.2</a></span>.<a href="#section-5.2-1" class="pilcrow">¶</a></p>
<p id="section-5.2-2">Upon receipt of the request, the Issuer validates the following conditions:<a href="#section-5.2-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.2-3.1">
            <p id="section-5.2-3.1.1">The BatchTokenRequest contains a supported token_type equal to one of the
batched token types defined in this document.<a href="#section-5.2-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.2-3.2">
            <p id="section-5.2-3.2.1">The BatchTokenRequest.truncated_token_key_id corresponds to a key ID of a
Public Key owned by the issuer.<a href="#section-5.2-3.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.2-3.3">
            <p id="section-5.2-3.3.1">Nr, as determined based on the size of BatchTokenRequest.blinded_elements, is
less than or equal to the number of tokens that the issuer can issue in a
single batch.<a href="#section-5.2-3.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-5.2-4">If any of these conditions is not met, the Issuer MUST return an HTTP 422
(Unprocessable Content) error to the client.<a href="#section-5.2-4" class="pilcrow">¶</a></p>
<p id="section-5.2-5">The Issuer then tries to deseralize the i-th element of
BatchTokenRequest.blinded_elements using DeserializeElement from <span><a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-voprf-21#section-2.1" class="relref">Section 2.1</a> of [<a href="#OPRF" class="cite xref">OPRF</a>]</span>, yielding <code>blinded_element_i</code> of type <code>Element</code>. If this fails for any
of the BatchTokenRequest.blinded_elements values, the Issuer MUST return an HTTP
422 (Unprocessable Content) error to the client. Otherwise, if the Issuer is
willing to produce a token to the Client, the issuer forms a list of <code>Element</code>
values, denoted <code>blinded_elements</code>, and computes a blinded response as follows:<a href="#section-5.2-5" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.2-6">
<pre>
server_context = SetupVOPRFServer(ciphersuiteID, skI, pkI)
evaluated_elements, proof =
  server_context.BlindEvaluateBatch(skI, blinded_elements)
</pre><a href="#section-5.2-6" class="pilcrow">¶</a>
</div>
<p id="section-5.2-7"><code>ciphersuiteID</code> is the ciphersuite identifier from <span>[<a href="#OPRF" class="cite xref">OPRF</a>]</span> corresponding to the
ciphersuite being used for this token version. SetupVOPRFServer is defined in
<span>[<a href="#OPRF" class="cite xref">OPRF</a>], <a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-voprf-21#section-3.2" class="relref">Section 3.2</a></span>. The issuer uses a list of blinded elements to compute in
the proof generation step. The <code>BlindEvaluateBatch</code> function is a batch-oriented
version of the <code>BlindEvaluate</code> function described in <span>[<a href="#OPRF" class="cite xref">OPRF</a>], <a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-voprf-21#section-3.3.2" class="relref">Section 3.3.2</a></span>.
The description of <code>BlindEvaluateBatch</code> is below.<a href="#section-5.2-7" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.2-8">
<pre>
Input:

  Element blindedElements[Nr]

Output:

  Element evaluatedElements[Nr]
  Proof proof

Parameters:

  Group G
  Scalar skS
  Element pkS

def BlindEvaluateBatch(blindedElements):
  evaluatedElements = []
  for blindedElement in blindedElements:
    evaluatedElements.append(skS * blindedElement)

  proof = GenerateProof(skS, G.Generator(), pkS,
                        blindedElements, evaluatedElements)
  return evaluatedElements, proof
</pre><a href="#section-5.2-8" class="pilcrow">¶</a>
</div>
<p id="section-5.2-9">The Issuer then creates a BatchTokenResponse structured as follows:<a href="#section-5.2-9" class="pilcrow">¶</a></p>
<div class="lang-tls sourcecode" id="section-5.2-10">
<pre>
struct {
    uint8_t evaluated_element[Ne];
} EvaluatedElement;

struct {
   EvaluatedElement evaluated_elements&lt;V&gt;;
   uint8_t evaluated_proof[Ns + Ns];
} BatchTokenResponse;
</pre><a href="#section-5.2-10" class="pilcrow">¶</a>
</div>
<p id="section-5.2-11">The structure fields are defined as follows:<a href="#section-5.2-11" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.2-12.1">
            <p id="section-5.2-12.1.1">"evaluated_elements" is a list of <code>Nr</code> serialized elements, each of length
<code>Ne</code> bytes and computed as <code>SerializeElement(evaluate_element_i)</code>, where
evaluate_element_i is the i-th output of <code>BlindEvaluate</code>.<a href="#section-5.2-12.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.2-12.2">
            <p id="section-5.2-12.2.1">"evaluated_proof" is the (Ns+Ns)-octet serialized proof, which is a pair of
Scalar values, computed as <code>concat(SerializeScalar(proof[0]),
SerializeScalar(proof[1]))</code>, where Ns is as defined in <span>[<a href="#OPRF" class="cite xref">OPRF</a>], <a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-voprf-21#section-4" class="relref">Section 4</a></span>.<a href="#section-5.2-12.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-5.2-13">The Issuer generates an HTTP response with status code 200 whose content
consists of TokenResponse, with the content type set as
"application/private-token-privately-verifiable-batch-response".<a href="#section-5.2-13" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.2-14">
<pre>
HTTP/1.1 200 OK
Content-Type: application/private-token-privately-verifiable-batch-response
Content-Length: &lt;Length of BatchTokenResponse&gt;

&lt;Bytes containing the BatchTokenResponse&gt;
</pre><a href="#section-5.2-14" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="finalization">
<section id="section-5.3">
        <h3 id="name-finalization">
<a href="#section-5.3" class="section-number selfRef">5.3. </a><a href="#name-finalization" class="section-name selfRef">Finalization</a>
        </h3>
<p id="section-5.3-1">Upon receipt, the Client handles the response and, if successful, deserializes
the body values TokenResponse.evaluate_response and
TokenResponse.evaluate_proof, yielding <code>evaluated_elements</code> and <code>proof</code>. If
deserialization of either value fails, the Client aborts the protocol.
Otherwise, the Client processes the response as follows:<a href="#section-5.3-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.3-2">
<pre>
authenticator_values = client_context.FinalizeBatch(token_input, blind,
                         evaluated_elements, blinded_elements, proof)
</pre><a href="#section-5.3-2" class="pilcrow">¶</a>
</div>
<p id="section-5.3-3">The <code>FinalizeBatch</code> function is a batched variant of the <code>Finalize</code> function as
defined in <span>[<a href="#OPRF" class="cite xref">OPRF</a>], <a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-voprf-21#section-3.3.2" class="relref">Section 3.3.2</a></span>. <code>FinalizeBatch</code> accepts lists of evaluated
elements and blinded elements as input parameters, and is implemented as
described below:<a href="#section-5.3-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.3-4">
<pre>
Input:

  PrivateInput input
  Scalar blind
  Element evaluatedElements[Nr]
  Element blindedElements[Nr]
  Proof proof

Output:

  opaque output[Nh * Nr]

Parameters:

  Group G
  Element pkS

Errors: VerifyError

def FinalizeBatch(input, blind,
  evaluatedElements, blindedElements, proof):
  if VerifyProof(G.Generator(), pkS, blindedElements,
                 evaluatedElements, proof) == false:
    raise VerifyError

  output = nil
  for evaluatedElement in evaluatedElements:
    N = G.ScalarInverse(blind) * evaluatedElement
    unblindedElement = G.SerializeElement(N)
    hashInput = I2OSP(len(input), 2) || input ||
                I2OSP(len(unblindedElement), 2) || unblindedElement ||
                "Finalize"
    output = concat(output, Hash(hashInput))

  return output
</pre><a href="#section-5.3-4" class="pilcrow">¶</a>
</div>
<p id="section-5.3-5">If this succeeds, the Client then constructs <code>Nr</code> Token values, where
<code>authenticator</code> is the i-th Nh-byte length slice of <code>authenticator_values</code> that
corresponds to <code>nonce</code>, the i-th nonce that was sampled in
<a href="#client-to-issuer-request" class="auto internal xref">Section 5.1</a>:<a href="#section-5.3-5" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.3-6">
<pre>
struct {
    uint16_t token_type;
    uint8_t nonce[32];
    uint8_t challenge_digest[32];
    uint8_t token_key_id[32];
    uint8_t authenticator[Nh];
} Token;
</pre><a href="#section-5.3-6" class="pilcrow">¶</a>
</div>
<p id="section-5.3-7">If the FinalizeBatch function fails, the Client aborts the protocol. Token
verification works exactly as specified in <span>[<a href="#RFC9578" class="cite xref">RFC9578</a>]</span>.<a href="#section-5.3-7" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="arbitrary-batched-token-issuance">
<section id="section-6">
      <h2 id="name-arbitrary-batched-token-iss">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-arbitrary-batched-token-iss" class="section-name selfRef">Arbitrary Batched Token Issuance</a>
      </h2>
<p id="section-6-1">This section describes an issuance protocol mechanism for issuing multiple
tokens in one round trip between Client and Issuer. An arbitrary batched token
request can contain token requests for any token type.<a href="#section-6-1" class="pilcrow">¶</a></p>
<div id="arbitrary-client-to-issuer-request">
<section id="section-6.1">
        <h3 id="name-client-to-issuer-request-2">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-client-to-issuer-request-2" class="section-name selfRef">Client-to-Issuer Request</a>
        </h3>
<p id="section-6.1-1">The Client first creates all TokenRequest it wants to batch. To do so, the
client follows protocol describing issuance, such as <span>[<a href="#RFC9578" class="cite xref">RFC9578</a>], <a href="https://datatracker.ietf.org/doc/html/draft-ietf-privacypass-protocol-16#section-5.1" class="relref">Section 5.1</a></span> or
<span>[<a href="#RFC9578" class="cite xref">RFC9578</a>], <a href="https://datatracker.ietf.org/doc/html/draft-ietf-privacypass-protocol-16#section-6.1" class="relref">Section 6.1</a></span>.<a href="#section-6.1-1" class="pilcrow">¶</a></p>
<p id="section-6.1-2">The Client then creates a BatchedTokenRequest structured as follows:<a href="#section-6.1-2" class="pilcrow">¶</a></p>
<div class="lang-tls sourcecode" id="section-6.1-3">
<pre>
struct {
   uint16_t token_type;
   select (token_type) {
      case (0x0001): /* Type VOPRF(P-384, SHA-384), RFC 9578 */
         uint8_t truncated_token_key_id;
         uint8_t blinded_msg[Ne];
      case (0x0002): /* Type Blind RSA (2048-bit), RFC 9578 */
         uint8_t truncated_token_key_id;
         uint8_t blinded_msg[Nk];
   }
} TokenRequest;

struct {
  TokenRequest token_requests&lt;V&gt;;
} BatchTokenRequest
</pre><a href="#section-6.1-3" class="pilcrow">¶</a>
</div>
<p id="section-6.1-4">The structure fields are defined as follows:<a href="#section-6.1-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.1-5.1">
            <p id="section-6.1-5.1.1">TokenRequest's "token_type" is a 2-octet integer. TokenRequest MUST always start
with a uint16 "token_type" indicating the token type. The rest of the
structure follows based on that type, within the inner opaque token_request
attribute. The above definition corresponds to TokenRequest from <span>[<a href="#RFC9578" class="cite xref">RFC9578</a>]</span>.
A TokenRequest with a token type not defined in <span>[<a href="#RFC9578" class="cite xref">RFC9578</a>]</span> MAY be used but
MUST always start with a 2-octet token_type.<a href="#section-6.1-5.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-6.1-5.2">
            <p id="section-6.1-5.2.1">"token_requests" is an array of TokenRequest satisfying the above constraint.<a href="#section-6.1-5.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-6.1-6">The Client then generates an HTTP POST request to send to the Issuer Request
URL, with the BatchTokenRequest as the content. The media type for this request
is "application/private-token-arbitrary-batch-request". An example request for
the Issuer Request URL "https://issuer.example.net/request" is shown below.<a href="#section-6.1-6" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-6.1-7">
<pre>
POST /request HTTP/1.1
Host: issuer.example.net
Accept: application/private-token-arbitrary-batch-response
Content-Type: application/private-token-arbitrary-batch-request
Content-Length: &lt;Length of BatchTokenRequest&gt;

&lt;Bytes containing the BatchTokenRequest&gt;
</pre><a href="#section-6.1-7" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="arbitrary-issuer-to-client-response">
<section id="section-6.2">
        <h3 id="name-issuer-to-client-response-2">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-issuer-to-client-response-2" class="section-name selfRef">Issuer-to-Client Response</a>
        </h3>
<p id="section-6.2-1">Upon receipt of the request, the Issuer validates the following conditions:<a href="#section-6.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.2-2.1">
            <p id="section-6.2-2.1.1">The Content-Type is application/private-token-arbitrary-batch-request as
registered with IANA.<a href="#section-6.2-2.1.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-6.2-3">If this condition is not met, the Issuer MUST return an HTTP 422 (Unprocessable
Content) error to the client.<a href="#section-6.2-3" class="pilcrow">¶</a></p>
<p id="section-6.2-4">The Issuer then tries to deserialize the first 2 bytes of the i-th element of
BatchTokenRequest.token_requests. If this is not a token type registered with
IANA, the Issuer MUST return an HTTP 422 (Unprocessable Content) error to the
client. The issuer creates a BatchTokenResponse structured as follows:<a href="#section-6.2-4" class="pilcrow">¶</a></p>
<div class="lang-tls sourcecode" id="section-6.2-5">
<pre>
struct {
  optional&lt;TokenResponse&gt; token_response; /* Defined by token_type */
} OptionalTokenResponse;

struct {
  OptionalTokenResponse token_responses&lt;V&gt;;
} BatchTokenResponse
</pre><a href="#section-6.2-5" class="pilcrow">¶</a>
</div>
<p id="section-6.2-6">BatchTokenResponse.token_responses is a vector of OptionalTokenResponses, length
prefixed with two bytes. OptionalTokenResponse.token_response is a
length-prefix-encoded TokenResponse, where a length of 0 indicates that the
Issuer failed or refused to issue the associated TokenRequest.<a href="#section-6.2-6" class="pilcrow">¶</a></p>
<p id="section-6.2-7">The Issuer generates an HTTP response with status code 200 whose content
consists of TokenResponse, with the content type set as
"application/private-token-arbitrary-batch-response".<a href="#section-6.2-7" class="pilcrow">¶</a></p>
<p id="section-6.2-8">If the Issuer issues some tokens but not all, it MUST return an HTTP 206 to the
client and continue processing further requests.<a href="#section-6.2-8" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-6.2-9">
<pre>
HTTP/1.1 200 OK
Content-Type: application/private-token-arbitrary-batch-response
Content-Length: &lt;Length of BatchTokenResponse&gt;

&lt;Bytes containing the BatchTokenResponse&gt;
</pre><a href="#section-6.2-9" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="arbitrary-finalization">
<section id="section-6.3">
        <h3 id="name-finalization-2">
<a href="#section-6.3" class="section-number selfRef">6.3. </a><a href="#name-finalization-2" class="section-name selfRef">Finalization</a>
        </h3>
<p id="section-6.3-1">The Client tries to deserialize the i-th element of
BatchTokenResponse.token_responses using the protocol associated to
BatchTokenRequest.token_type. If the element has a size of 0, the Client MUST
ignore this token, and continue processing the next token. The Client finalizes
each deserialized TokenResponse using the matching TokenRequest according to the
corresponding finalization procedure defined by the token type.<a href="#section-6.3-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="security-considerations">
<section id="section-7">
      <h2 id="name-security-considerations">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-security-considerations" class="section-name selfRef">Security considerations</a>
      </h2>
<div id="batched-privately-verifiable-tokens">
<section id="section-7.1">
        <h3 id="name-batched-privately-verifiable">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-batched-privately-verifiable" class="section-name selfRef">Batched Privately Verifiable Tokens</a>
        </h3>
<p id="section-7.1-1">Implementors SHOULD be aware of the security considerations described in <span>[<a href="#OPRF" class="cite xref">OPRF</a>], <a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-voprf-21#section-6.2.3" class="relref">Section 6.2.3</a></span> and implement mitigation mechanisms. Application can mitigate
this issue by limiting the number of clients and limiting the number of token
requests per client per key.<a href="#section-7.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="arbitrary-batched-verifiable-tokens">
<section id="section-7.2">
        <h3 id="name-arbitrary-batched-verifiabl">
<a href="#section-7.2" class="section-number selfRef">7.2. </a><a href="#name-arbitrary-batched-verifiabl" class="section-name selfRef">Arbitrary Batched Verifiable Tokens</a>
        </h3>
<p id="section-7.2-1">Implementors SHOULD be aware of the inherent linear cost of this token type. An
Issuer MAY ignore TokenRequest if the number of tokens per request past a limit.<a href="#section-7.2-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="iana-considerations">
<section id="section-8">
      <h2 id="name-iana-considerations">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA considerations</a>
      </h2>
<p id="section-8-1">This section contains IANA codepoint allocation requests.<a href="#section-8-1" class="pilcrow">¶</a></p>
<div id="iana-token-type">
<section id="section-8.1">
        <h3 id="name-token-type">
<a href="#section-8.1" class="section-number selfRef">8.1. </a><a href="#name-token-type" class="section-name selfRef">Token Type</a>
        </h3>
<p id="section-8.1-1">This document updates the "Token Type" Registry (<span>[<a href="#AUTHSCHEME" class="cite xref">AUTHSCHEME</a>]</span>) with the
following entry:<a href="#section-8.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.1-2.1">
            <p id="section-8.1-2.1.1">Value: 0xF91A<a href="#section-8.1-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-8.1-2.2">
            <p id="section-8.1-2.2.1">Name: VOPRF (ristretto255, SHA-512)<a href="#section-8.1-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-8.1-2.3">
            <p id="section-8.1-2.3.1">Token Structure: As defined in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-privacypass-auth-scheme-15#section-2.2" class="relref">Section 2.2</a> of [<a href="#AUTHSCHEME" class="cite xref">AUTHSCHEME</a>]</span><a href="#section-8.1-2.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-8.1-2.4">
            <p id="section-8.1-2.4.1">Token Key Encoding: Serialized using SerializeElement from <span><a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-voprf-21#section-2.1" class="relref">Section 2.1</a> of [<a href="#OPRF" class="cite xref">OPRF</a>]</span><a href="#section-8.1-2.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-8.1-2.5">
            <p id="section-8.1-2.5.1">TokenChallenge Structure: As defined in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-privacypass-auth-scheme-15#section-2.1" class="relref">Section 2.1</a> of [<a href="#AUTHSCHEME" class="cite xref">AUTHSCHEME</a>]</span><a href="#section-8.1-2.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-8.1-2.6">
            <p id="section-8.1-2.6.1">Publicly Verifiable: N<a href="#section-8.1-2.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-8.1-2.7">
            <p id="section-8.1-2.7.1">Public Metadata: N<a href="#section-8.1-2.7.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-8.1-2.8">
            <p id="section-8.1-2.8.1">Private Metadata: N<a href="#section-8.1-2.8.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-8.1-2.9">
            <p id="section-8.1-2.9.1">Nk: 32<a href="#section-8.1-2.9.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-8.1-2.10">
            <p id="section-8.1-2.10.1">Nid: 32<a href="#section-8.1-2.10.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-8.1-2.11">
            <p id="section-8.1-2.11.1">Reference: <span>[<a href="#RFC9578" class="cite xref">RFC9578</a>], <a href="https://datatracker.ietf.org/doc/html/draft-ietf-privacypass-protocol-16#section-5" class="relref">Section 5</a></span><a href="#section-8.1-2.11.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-8.1-2.12">
            <p id="section-8.1-2.12.1">Notes: None<a href="#section-8.1-2.12.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="media-types">
<section id="section-8.2">
        <h3 id="name-media-types">
<a href="#section-8.2" class="section-number selfRef">8.2. </a><a href="#name-media-types" class="section-name selfRef">Media Types</a>
        </h3>
<p id="section-8.2-1">The following entries should be added to the IANA "media types" registry:<a href="#section-8.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.2-2.1">
            <p id="section-8.2-2.1.1">"application/private-token-privately-verifiable-batch-request"<a href="#section-8.2-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-8.2-2.2">
            <p id="section-8.2-2.2.1">"application/private-token-privately-verifiable-batch-response"<a href="#section-8.2-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-8.2-2.3">
            <p id="section-8.2-2.3.1">"application/private-token-arbitrary-batch-request"<a href="#section-8.2-2.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-8.2-2.4">
            <p id="section-8.2-2.4.1">"application/private-token-arbitrary-batch-response"<a href="#section-8.2-2.4.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-8.2-3">The templates for these entries are listed below and the reference should be
this RFC.<a href="#section-8.2-3" class="pilcrow">¶</a></p>
<div id="applicationprivate-token-privately-verifiable-batch-request-media-type">
<section id="section-8.2.1">
          <h4 id="name-application-private-token-p">
<a href="#section-8.2.1" class="section-number selfRef">8.2.1. </a><a href="#name-application-private-token-p" class="section-name selfRef">"application/private-token-privately-verifiable-batch-request" media type</a>
          </h4>
<span class="break"></span><dl class="dlCompact dlParallel" id="section-8.2.1-1">
            <dt id="section-8.2.1-1.1">Type name:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.1-1.2">
              <p id="section-8.2.1-1.2.1">application<a href="#section-8.2.1-1.2.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.2.1-1.3">Subtype name:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.1-1.4">
              <p id="section-8.2.1-1.4.1">private-token-request<a href="#section-8.2.1-1.4.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.2.1-1.5">Required parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.1-1.6">
              <p id="section-8.2.1-1.6.1">N/A<a href="#section-8.2.1-1.6.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.2.1-1.7">Optional parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.1-1.8">
              <p id="section-8.2.1-1.8.1">N/A<a href="#section-8.2.1-1.8.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.2.1-1.9">Encoding considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.1-1.10">
              <p id="section-8.2.1-1.10.1">"binary"<a href="#section-8.2.1-1.10.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.2.1-1.11">Security considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.1-1.12">
              <p id="section-8.2.1-1.12.1">see <a href="#security-considerations" class="auto internal xref">Section 7</a><a href="#section-8.2.1-1.12.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.2.1-1.13">Interoperability considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.1-1.14">
              <p id="section-8.2.1-1.14.1">N/A<a href="#section-8.2.1-1.14.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.2.1-1.15">Published specification:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.1-1.16">
              <p id="section-8.2.1-1.16.1">this specification<a href="#section-8.2.1-1.16.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.2.1-1.17">Applications that use this media type:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.1-1.18">
              <p id="section-8.2.1-1.18.1">Applications that want to issue or facilitate issuance of Privacy Pass tokens,
including Privacy Pass issuer applications themselves.<a href="#section-8.2.1-1.18.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.2.1-1.19">Fragment identifier considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.1-1.20">
              <p id="section-8.2.1-1.20.1">N/A<a href="#section-8.2.1-1.20.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.2.1-1.21">Additional information:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.1-1.22">
              <span class="break"></span><dl class="dlCompact dlParallel" id="section-8.2.1-1.22.1">
                <dt id="section-8.2.1-1.22.1.1">Magic number(s):</dt>
                <dd style="margin-left: 1.5em" id="section-8.2.1-1.22.1.2">N/A<a href="#section-8.2.1-1.22.1.2" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-8.2.1-1.22.1.3">Deprecated alias names for this type:</dt>
                <dd style="margin-left: 1.5em" id="section-8.2.1-1.22.1.4">N/A<a href="#section-8.2.1-1.22.1.4" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-8.2.1-1.22.1.5">File extension(s):</dt>
                <dd style="margin-left: 1.5em" id="section-8.2.1-1.22.1.6">N/A<a href="#section-8.2.1-1.22.1.6" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-8.2.1-1.22.1.7">Macintosh file type code(s):</dt>
                <dd style="margin-left: 1.5em" id="section-8.2.1-1.22.1.8">N/A<a href="#section-8.2.1-1.22.1.8" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
</dl>
</dd>
            <dd class="break"></dd>
<dt id="section-8.2.1-1.23">Person and email address to contact for further information:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.1-1.24">
              <p id="section-8.2.1-1.24.1">see Authors' Addresses section<a href="#section-8.2.1-1.24.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.2.1-1.25">Intended usage:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.1-1.26">
              <p id="section-8.2.1-1.26.1">COMMON<a href="#section-8.2.1-1.26.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.2.1-1.27">Restrictions on usage:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.1-1.28">
              <p id="section-8.2.1-1.28.1">N/A<a href="#section-8.2.1-1.28.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.2.1-1.29">Author:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.1-1.30">
              <p id="section-8.2.1-1.30.1">see Authors' Addresses section<a href="#section-8.2.1-1.30.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.2.1-1.31">Change controller:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.1-1.32">
              <p id="section-8.2.1-1.32.1">IETF<a href="#section-8.2.1-1.32.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<div id="applicationprivate-token-privately-verifiable-batch-response-media-type">
<section id="section-8.2.2">
          <h4 id="name-application-private-token-pr">
<a href="#section-8.2.2" class="section-number selfRef">8.2.2. </a><a href="#name-application-private-token-pr" class="section-name selfRef">"application/private-token-privately-verifiable-batch-response" media type</a>
          </h4>
<span class="break"></span><dl class="dlCompact dlParallel" id="section-8.2.2-1">
            <dt id="section-8.2.2-1.1">Type name:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.2-1.2">
              <p id="section-8.2.2-1.2.1">application<a href="#section-8.2.2-1.2.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.2.2-1.3">Subtype name:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.2-1.4">
              <p id="section-8.2.2-1.4.1">private-token-response<a href="#section-8.2.2-1.4.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.2.2-1.5">Required parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.2-1.6">
              <p id="section-8.2.2-1.6.1">N/A<a href="#section-8.2.2-1.6.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.2.2-1.7">Optional parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.2-1.8">
              <p id="section-8.2.2-1.8.1">N/A<a href="#section-8.2.2-1.8.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.2.2-1.9">Encoding considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.2-1.10">
              <p id="section-8.2.2-1.10.1">"binary"<a href="#section-8.2.2-1.10.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.2.2-1.11">Security considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.2-1.12">
              <p id="section-8.2.2-1.12.1">see <a href="#security-considerations" class="auto internal xref">Section 7</a><a href="#section-8.2.2-1.12.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.2.2-1.13">Interoperability considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.2-1.14">
              <p id="section-8.2.2-1.14.1">N/A<a href="#section-8.2.2-1.14.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.2.2-1.15">Published specification:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.2-1.16">
              <p id="section-8.2.2-1.16.1">this specification<a href="#section-8.2.2-1.16.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.2.2-1.17">Applications that use this media type:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.2-1.18">
              <p id="section-8.2.2-1.18.1">Applications that want to issue or facilitate issuance of Privacy Pass tokens,
including Privacy Pass issuer applications themselves.<a href="#section-8.2.2-1.18.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.2.2-1.19">Fragment identifier considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.2-1.20">
              <p id="section-8.2.2-1.20.1">N/A<a href="#section-8.2.2-1.20.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.2.2-1.21">Additional information:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.2-1.22">
              <span class="break"></span><dl class="dlCompact dlParallel" id="section-8.2.2-1.22.1">
                <dt id="section-8.2.2-1.22.1.1">Magic number(s):</dt>
                <dd style="margin-left: 1.5em" id="section-8.2.2-1.22.1.2">N/A<a href="#section-8.2.2-1.22.1.2" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-8.2.2-1.22.1.3">Deprecated alias names for this type:</dt>
                <dd style="margin-left: 1.5em" id="section-8.2.2-1.22.1.4">N/A<a href="#section-8.2.2-1.22.1.4" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-8.2.2-1.22.1.5">File extension(s):</dt>
                <dd style="margin-left: 1.5em" id="section-8.2.2-1.22.1.6">N/A<a href="#section-8.2.2-1.22.1.6" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-8.2.2-1.22.1.7">Macintosh file type code(s):</dt>
                <dd style="margin-left: 1.5em" id="section-8.2.2-1.22.1.8">N/A<a href="#section-8.2.2-1.22.1.8" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
</dl>
</dd>
            <dd class="break"></dd>
<dt id="section-8.2.2-1.23">Person and email address to contact for further information:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.2-1.24">
              <p id="section-8.2.2-1.24.1">see Authors' Addresses section<a href="#section-8.2.2-1.24.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.2.2-1.25">Intended usage:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.2-1.26">
              <p id="section-8.2.2-1.26.1">COMMON<a href="#section-8.2.2-1.26.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.2.2-1.27">Restrictions on usage:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.2-1.28">
              <p id="section-8.2.2-1.28.1">N/A<a href="#section-8.2.2-1.28.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.2.2-1.29">Author:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.2-1.30">
              <p id="section-8.2.2-1.30.1">see Authors' Addresses section<a href="#section-8.2.2-1.30.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.2.2-1.31">Change controller:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.2-1.32">
              <p id="section-8.2.2-1.32.1">IETF<a href="#section-8.2.2-1.32.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<div id="applicationprivate-token-arbitrary-batch-request-media-type">
<section id="section-8.2.3">
          <h4 id="name-application-private-token-a">
<a href="#section-8.2.3" class="section-number selfRef">8.2.3. </a><a href="#name-application-private-token-a" class="section-name selfRef">"application/private-token-arbitrary-batch-request" media type</a>
          </h4>
<span class="break"></span><dl class="dlCompact dlParallel" id="section-8.2.3-1">
            <dt id="section-8.2.3-1.1">Type name:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.3-1.2">
              <p id="section-8.2.3-1.2.1">application<a href="#section-8.2.3-1.2.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.2.3-1.3">Subtype name:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.3-1.4">
              <p id="section-8.2.3-1.4.1">private-token-request<a href="#section-8.2.3-1.4.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.2.3-1.5">Required parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.3-1.6">
              <p id="section-8.2.3-1.6.1">N/A<a href="#section-8.2.3-1.6.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.2.3-1.7">Optional parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.3-1.8">
              <p id="section-8.2.3-1.8.1">N/A<a href="#section-8.2.3-1.8.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.2.3-1.9">Encoding considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.3-1.10">
              <p id="section-8.2.3-1.10.1">"binary"<a href="#section-8.2.3-1.10.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.2.3-1.11">Security considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.3-1.12">
              <p id="section-8.2.3-1.12.1">see <a href="#security-considerations" class="auto internal xref">Section 7</a><a href="#section-8.2.3-1.12.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.2.3-1.13">Interoperability considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.3-1.14">
              <p id="section-8.2.3-1.14.1">N/A<a href="#section-8.2.3-1.14.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.2.3-1.15">Published specification:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.3-1.16">
              <p id="section-8.2.3-1.16.1">this specification<a href="#section-8.2.3-1.16.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.2.3-1.17">Applications that use this media type:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.3-1.18">
              <p id="section-8.2.3-1.18.1">Applications that want to issue or facilitate issuance of Privacy Pass tokens,
including Privacy Pass issuer applications themselves.<a href="#section-8.2.3-1.18.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.2.3-1.19">Fragment identifier considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.3-1.20">
              <p id="section-8.2.3-1.20.1">N/A<a href="#section-8.2.3-1.20.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.2.3-1.21">Additional information:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.3-1.22">
              <span class="break"></span><dl class="dlCompact dlParallel" id="section-8.2.3-1.22.1">
                <dt id="section-8.2.3-1.22.1.1">Magic number(s):</dt>
                <dd style="margin-left: 1.5em" id="section-8.2.3-1.22.1.2">N/A<a href="#section-8.2.3-1.22.1.2" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-8.2.3-1.22.1.3">Deprecated alias names for this type:</dt>
                <dd style="margin-left: 1.5em" id="section-8.2.3-1.22.1.4">N/A<a href="#section-8.2.3-1.22.1.4" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-8.2.3-1.22.1.5">File extension(s):</dt>
                <dd style="margin-left: 1.5em" id="section-8.2.3-1.22.1.6">N/A<a href="#section-8.2.3-1.22.1.6" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-8.2.3-1.22.1.7">Macintosh file type code(s):</dt>
                <dd style="margin-left: 1.5em" id="section-8.2.3-1.22.1.8">N/A<a href="#section-8.2.3-1.22.1.8" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
</dl>
</dd>
            <dd class="break"></dd>
<dt id="section-8.2.3-1.23">Person and email address to contact for further information:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.3-1.24">
              <p id="section-8.2.3-1.24.1">see Authors' Addresses section<a href="#section-8.2.3-1.24.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.2.3-1.25">Intended usage:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.3-1.26">
              <p id="section-8.2.3-1.26.1">COMMON<a href="#section-8.2.3-1.26.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.2.3-1.27">Restrictions on usage:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.3-1.28">
              <p id="section-8.2.3-1.28.1">N/A<a href="#section-8.2.3-1.28.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.2.3-1.29">Author:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.3-1.30">
              <p id="section-8.2.3-1.30.1">see Authors' Addresses section<a href="#section-8.2.3-1.30.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.2.3-1.31">Change controller:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.3-1.32">
              <p id="section-8.2.3-1.32.1">IETF<a href="#section-8.2.3-1.32.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<div id="applicationprivate-token-arbitrary-batch-response-media-type">
<section id="section-8.2.4">
          <h4 id="name-application-private-token-ar">
<a href="#section-8.2.4" class="section-number selfRef">8.2.4. </a><a href="#name-application-private-token-ar" class="section-name selfRef">"application/private-token-arbitrary-batch-response" media type</a>
          </h4>
<span class="break"></span><dl class="dlCompact dlParallel" id="section-8.2.4-1">
            <dt id="section-8.2.4-1.1">Type name:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.4-1.2">
              <p id="section-8.2.4-1.2.1">application<a href="#section-8.2.4-1.2.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.2.4-1.3">Subtype name:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.4-1.4">
              <p id="section-8.2.4-1.4.1">private-token-response<a href="#section-8.2.4-1.4.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.2.4-1.5">Required parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.4-1.6">
              <p id="section-8.2.4-1.6.1">N/A<a href="#section-8.2.4-1.6.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.2.4-1.7">Optional parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.4-1.8">
              <p id="section-8.2.4-1.8.1">N/A<a href="#section-8.2.4-1.8.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.2.4-1.9">Encoding considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.4-1.10">
              <p id="section-8.2.4-1.10.1">"binary"<a href="#section-8.2.4-1.10.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.2.4-1.11">Security considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.4-1.12">
              <p id="section-8.2.4-1.12.1">see <a href="#security-considerations" class="auto internal xref">Section 7</a><a href="#section-8.2.4-1.12.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.2.4-1.13">Interoperability considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.4-1.14">
              <p id="section-8.2.4-1.14.1">N/A<a href="#section-8.2.4-1.14.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.2.4-1.15">Published specification:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.4-1.16">
              <p id="section-8.2.4-1.16.1">this specification<a href="#section-8.2.4-1.16.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.2.4-1.17">Applications that use this media type:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.4-1.18">
              <p id="section-8.2.4-1.18.1">Applications that want to issue or facilitate issuance of Privacy Pass tokens,
including Privacy Pass issuer applications themselves.<a href="#section-8.2.4-1.18.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.2.4-1.19">Fragment identifier considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.4-1.20">
              <p id="section-8.2.4-1.20.1">N/A<a href="#section-8.2.4-1.20.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.2.4-1.21">Additional information:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.4-1.22">
              <span class="break"></span><dl class="dlCompact dlParallel" id="section-8.2.4-1.22.1">
                <dt id="section-8.2.4-1.22.1.1">Magic number(s):</dt>
                <dd style="margin-left: 1.5em" id="section-8.2.4-1.22.1.2">N/A<a href="#section-8.2.4-1.22.1.2" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-8.2.4-1.22.1.3">Deprecated alias names for this type:</dt>
                <dd style="margin-left: 1.5em" id="section-8.2.4-1.22.1.4">N/A<a href="#section-8.2.4-1.22.1.4" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-8.2.4-1.22.1.5">File extension(s):</dt>
                <dd style="margin-left: 1.5em" id="section-8.2.4-1.22.1.6">N/A<a href="#section-8.2.4-1.22.1.6" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-8.2.4-1.22.1.7">Macintosh file type code(s):</dt>
                <dd style="margin-left: 1.5em" id="section-8.2.4-1.22.1.8">N/A<a href="#section-8.2.4-1.22.1.8" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
</dl>
</dd>
            <dd class="break"></dd>
<dt id="section-8.2.4-1.23">Person and email address to contact for further information:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.4-1.24">
              <p id="section-8.2.4-1.24.1">see Authors' Addresses section<a href="#section-8.2.4-1.24.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.2.4-1.25">Intended usage:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.4-1.26">
              <p id="section-8.2.4-1.26.1">COMMON<a href="#section-8.2.4-1.26.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.2.4-1.27">Restrictions on usage:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.4-1.28">
              <p id="section-8.2.4-1.28.1">N/A<a href="#section-8.2.4-1.28.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.2.4-1.29">Author:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.4-1.30">
              <p id="section-8.2.4-1.30.1">see Authors' Addresses section<a href="#section-8.2.4-1.30.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.2.4-1.31">Change controller:</dt>
            <dd style="margin-left: 1.5em" id="section-8.2.4-1.32">
              <p id="section-8.2.4-1.32.1">IETF<a href="#section-8.2.4-1.32.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="sec-combined-references">
<section id="section-9">
      <h2 id="name-references">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<div id="sec-normative-references">
<section id="section-9.1">
        <h3 id="name-normative-references">
<a href="#section-9.1" class="section-number selfRef">9.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="AUTHSCHEME">[AUTHSCHEME]</dt>
        <dd>
<span class="refAuthor">Pauly, T.</span>, <span class="refAuthor">Valdez, S.</span>, and <span class="refAuthor">C. A. Wood</span>, <span class="refTitle">"The Privacy Pass HTTP Authentication Scheme"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-privacypass-auth-scheme-15</span>, <time datetime="2023-10-23" class="refDate">23 October 2023</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-privacypass-auth-scheme-15">https://datatracker.ietf.org/doc/html/draft-ietf-privacypass-auth-scheme-15</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="OPRF">[OPRF]</dt>
        <dd>
<span class="refAuthor">Davidson, A.</span>, <span class="refAuthor">Faz-Hernandez, A.</span>, <span class="refAuthor">Sullivan, N.</span>, and <span class="refAuthor">C. A. Wood</span>, <span class="refTitle">"Oblivious Pseudorandom Functions (OPRFs) using Prime-Order Groups"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-irtf-cfrg-voprf-21</span>, <time datetime="2023-02-21" class="refDate">21 February 2023</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-voprf-21">https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-voprf-21</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8446">[RFC8446]</dt>
        <dd>
<span class="refAuthor">Rescorla, E.</span>, <span class="refTitle">"The Transport Layer Security (TLS) Protocol Version 1.3"</span>, <span class="seriesInfo">RFC 8446</span>, <span class="seriesInfo">DOI 10.17487/RFC8446</span>, <time datetime="2018-08" class="refDate">August 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8446">https://www.rfc-editor.org/rfc/rfc8446</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9576">[RFC9576]</dt>
        <dd>
<span class="refAuthor">Davidson, A.</span>, <span class="refAuthor">Iyengar, J.</span>, and <span class="refAuthor">C. A. Wood</span>, <span class="refTitle">"The Privacy Pass Architecture"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-privacypass-architecture-16</span>, <time datetime="2023-09-25" class="refDate">25 September 2023</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-privacypass-architecture-16">https://datatracker.ietf.org/doc/html/draft-ietf-privacypass-architecture-16</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9578">[RFC9578]</dt>
      <dd>
<span class="refAuthor">Celi, S.</span>, <span class="refAuthor">Davidson, A.</span>, <span class="refAuthor">Valdez, S.</span>, and <span class="refAuthor">C. A. Wood</span>, <span class="refTitle">"Privacy Pass Issuance Protocol"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-privacypass-protocol-16</span>, <time datetime="2023-10-03" class="refDate">3 October 2023</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-privacypass-protocol-16">https://datatracker.ietf.org/doc/html/draft-ietf-privacypass-protocol-16</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
<div id="sec-informative-references">
<section id="section-9.2">
        <h3 id="name-informative-references">
<a href="#section-9.2" class="section-number selfRef">9.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="HTTP3">[HTTP3]</dt>
        <dd>
<span class="refAuthor">Bishop, M., Ed.</span>, <span class="refTitle">"HTTP/3"</span>, <span class="seriesInfo">RFC 9114</span>, <span class="seriesInfo">DOI 10.17487/RFC9114</span>, <time datetime="2022-06" class="refDate">June 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9114">https://www.rfc-editor.org/rfc/rfc9114</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9000">[RFC9000]</dt>
      <dd>
<span class="refAuthor">Iyengar, J., Ed.</span> and <span class="refAuthor">M. Thomson, Ed.</span>, <span class="refTitle">"QUIC: A UDP-Based Multiplexed and Secure Transport"</span>, <span class="seriesInfo">RFC 9000</span>, <span class="seriesInfo">DOI 10.17487/RFC9000</span>, <time datetime="2021-05" class="refDate">May 2021</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9000">https://www.rfc-editor.org/rfc/rfc9000</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-A">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Raphael Robert</span></div>
<div dir="auto" class="left"><span class="org">Phoenix R&amp;D</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:ietf@raphaelrobert.com" class="email">ietf@raphaelrobert.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Christopher A. Wood</span></div>
<div dir="auto" class="left"><span class="org">Cloudflare</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:caw@heapingbits.net" class="email">caw@heapingbits.net</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
